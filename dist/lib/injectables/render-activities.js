var p="/eminusapi/api/Cursos/getAllCourses",d="/eminusapi/api/Actividad/getActividadesEstudiante/";var g=async(r,e)=>{try{let t=await fetch("https://eminus-homeworks-api.rafabeltrans17.workers.dev/api/description",{method:"POST",body:JSON.stringify({description:e})});if(console.log(t),!t.ok)throw new Error("Failed to fetch summary");let o=await t.text();return chrome.storage.local.set({[String(r)]:o}),o}catch{return"No se tiene descripci\xF3n"}};var y=async(r,e)=>{try{let t=await chrome.storage.local.get([String(r)]);if(console.log("ya busque"),!t[String(r)]){let o=await g(r,e);return console.log("llame la api"),console.log(o),o}return t[String(r)]}catch{return"Error obteniendo la descripci\xF3n"}};var h=async r=>Promise.all(r.map(async e=>{let t=await y(e.idActividad,e.descripcion);return{idCurso:e.idCurso,idActividad:e.idActividad,fechaEntrega:e.fechaEntrega,descripcion:t,titulo:e.titulo,fechaInicio:e.fechaInicio,fechaTermino:e.fechaTermino}}));var f=async r=>{let e=await chrome.storage.local.get(),t=Object.keys(e),o=r.map(s=>String(s.idActividad)),n=t.filter(s=>!o.includes(s));console.log(`acts to remove: ${n.length}`),n.length>0&&await chrome.storage.local.remove(n)};var v=async(r,e)=>{try{let o=await(await fetch(`https://eminus.uv.mx/${e}`,{headers:{authorization:`Bearer ${r}`},method:"GET"})).text();if(!o.trim())throw new Error("Empty response");return JSON.parse(o)}catch{return[]}},C=async r=>{try{let e=await v(r,p);if(!e||e.length==0)throw new Error("No courses found");return e.filter(o=>new Date(o.curso.fechaTermino)>new Date&&o.curso.archivado==0)}catch(e){return console.error(e),[]}},T=async(r,e)=>{try{let t=await v(r,`${d}/${e}`);if(!t||t.length==0)throw new Error("No activities found");let o=t.filter(n=>new Date(n.fechaTermino)>new Date);return h(o)}catch{return[]}},A=async r=>{try{let e=await C(r),t=[];for(let o of e){let s=(await T(r,o.curso.idCurso)).map(i=>({...i,course:o.curso.nombre}));t.push(...s)}return f(t),t.sort((o,n)=>new Date(o.fechaTermino).getTime()-new Date(n.fechaTermino).getTime())}catch{return[]}};var w=(r,e)=>{let t={config:{demo:"default",navegation:{course:{id:r,permission:2,unit:0,activity:e,forum:0,exam:0,view_student:!1,type:1},forum:{comment:0},member:{user:""},tracing:{user:""},exam:{id:"",ending:""}}}};return localStorage.setItem("layoutConfigNavegation",JSON.stringify(t)),localStorage.setItem("courseId",String(r)),localStorage.setItem("changeActivityId",String(e)),window.location.assign("https://eminus.uv.mx/eminus4/page/course/activity/delivery"),t};var _=(r,e,t,o)=>{A(r).then(n=>{let s=document.createElement("p");s.textContent=n.length,s.style.fontSize="1.4rem",s.style.fontWeight="500",e.appendChild(s);let i=document.createElement("ul");if(i.style.display="flex",i.style.flexDirection="column",i.style.gap="20px",n.length===0){let c=document.createElement("p");c.textContent="No tienes pendientes",o.remove(),i.remove(),t.appendChild(c)}else t.remove(),i.classList.add("acts-list"),i.style.overflowX="hidden",i.style.overflowY="auto",i.style.maxHeight="53rem",i.style.width="100%",e.appendChild(i);n.forEach(c=>{let u=document.createElement("li");u.style.decoration="none";let a=document.createElement("div");a.className="act-item",a.style.borderRadius="5px",a.style.cursor="pointer",a.addEventListener("click",()=>{w(c.idCurso,c.idActividad)});let m=document.createElement("p");m.textContent=c.titulo,m.style.fontWeight="bold",m.style.fontSize="1.1rem";let l=document.createElement("div");l.innerHTML=`
<p>${c.course||""}</p>
<p><strong>Entrega:</strong> ${new Date(c.fechaTermino).toLocaleString("es-MX")}<p>
    <span><p><strong>Descripcion:</strong></p> ${c.descripcion}</span>
`,u.appendChild(a),l.insertBefore(m,l.firstChild),a.appendChild(l),i.appendChild(a)})})};export{_ as renderActivities};
