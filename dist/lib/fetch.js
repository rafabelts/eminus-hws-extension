var c="/eminusapi/api/Cursos/getAllCourses",n="/eminusapi/api/Actividad/getActividadesEstudiante/";var a=async(o,r)=>{try{let t=await fetch("https://eminus-homeworks-api.rafabeltrans17.workers.dev/api/description",{method:"POST",body:JSON.stringify({description:r})});if(console.log(t),!t.ok)throw new Error("Failed to fetch summary");let e=await t.text();return chrome.storage.local.set({[String(o)]:e}),e}catch{return"No se tiene descripci\xF3n"}};var m=async(o,r)=>{try{let t=await chrome.storage.local.get([String(o)]);if(console.log("ya busque"),!t[String(o)]){let e=await a(o,r);return console.log("llame la api"),console.log(e),e}return t[String(o)]}catch{return"Error obteniendo la descripci\xF3n"}};var u=async o=>Promise.all(o.map(async r=>{let t=await m(r.idActividad,r.descripcion);return{idCurso:r.idCurso,idActividad:r.idActividad,fechaEntrega:r.fechaEntrega,descripcion:t,titulo:r.titulo,fechaInicio:r.fechaInicio,fechaTermino:r.fechaTermino}}));var p=async o=>{let r=await chrome.storage.local.get(),t=Object.keys(r),e=o.map(s=>String(s.idActividad)),i=t.filter(s=>!e.includes(s));console.log(`acts to remove: ${i.length}`),i.length>0&&await chrome.storage.local.remove(i)};var h=async(o,r)=>{try{let e=await(await fetch(`https://eminus.uv.mx/${r}`,{headers:{authorization:`Bearer ${o}`},method:"GET"})).text();if(!e.trim())throw new Error("Empty response");return JSON.parse(e)}catch{return[]}},y=async o=>{try{let r=await h(o,c);if(!r||r.length==0)throw new Error("No courses found");return r.filter(e=>new Date(e.curso.fechaTermino)>new Date&&e.curso.archivado==0)}catch(r){return console.error(r),[]}},d=async(o,r)=>{try{let t=await h(o,`${n}/${r}`);if(!t||t.length==0)throw new Error("No activities found");let e=t.filter(i=>new Date(i.fechaTermino)>new Date);return u(e)}catch{return[]}},x=async o=>{try{let r=await y(o),t=[];for(let e of r){let s=(await d(o,e.curso.idCurso)).map(l=>({...l,course:e.curso.nombre}));t.push(...s)}return p(t),t.sort((e,i)=>new Date(e.fechaTermino).getTime()-new Date(i.fechaTermino).getTime())}catch{return[]}};export{x as getAllActivities,y as getCourses};
