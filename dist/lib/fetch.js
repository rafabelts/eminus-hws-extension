var c="/eminusapi/api/Cursos/getAllCourses",n="/eminusapi/api/Actividad/getActividadesEstudiante/";var a=async(e,r)=>{try{let t=await fetch("https://eminus-homeworks-api.rafabeltrans17.workers.dev/api/description",{method:"POST",body:JSON.stringify({description:r})});if(console.log("API called"),!t.ok)throw new Error("Failed to fetch summary");let o=await t.text();return chrome.storage.local.set({[String(e)]:o}),t.text()}catch{return"No se tiene descripci\xF3n"}};var m=async(e,r)=>{try{let t=await chrome.storage.local.get([String(e)]);return t[String(e)]?t[String(e)]:await a(e,r)}catch{return"Error obteniendo la descripci\xF3n"}};var u=async e=>Promise.all(e.map(async r=>{let t=await m(r.idActividad,r.descripcion);return{idCurso:r.idCurso,idActividad:r.idActividad,fechaEntrega:r.fechaEntrega,descripcion:t,titulo:r.titulo,fechaInicio:r.fechaInicio,fechaTermino:r.fechaTermino}}));var p=async e=>{let r=await chrome.storage.local.get(),t=Object.keys(r),o=e.map(s=>String(s.idActividad)),i=t.filter(s=>!o.includes(s));console.log(`acts to remove: ${i.length}`),i.length>0&&await chrome.storage.local.remove(i)};var h=async(e,r)=>{try{let o=await(await fetch(`https://eminus.uv.mx/${r}`,{headers:{authorization:`Bearer ${e}`},method:"GET"})).text();if(!o.trim())throw new Error("Empty response");return JSON.parse(o)}catch{return[]}},d=async e=>{try{let r=await h(e,c);if(!r||r.length==0)throw new Error("No courses found");return r.filter(o=>new Date(o.curso.fechaTermino)>new Date&&o.curso.archivado==0)}catch(r){return console.error(r),[]}},l=async(e,r)=>{try{let t=await h(e,`${n}/${r}`);if(!t||t.length==0)throw new Error("No activities found");let o=t.filter(i=>new Date(i.fechaTermino)>new Date);return u(o)}catch{return[]}},x=async e=>{try{let r=await d(e),t=[];for(let o of r){let s=(await l(e,o.curso.idCurso)).map(y=>({...y,course:o.curso.nombre}));t.push(...s)}return p(t),t.sort((o,i)=>new Date(o.fechaTermino).getTime()-new Date(i.fechaTermino).getTime())}catch{return[]}};export{x as getAllActivities,d as getCourses};
